
(function(){var l="px";var h=false;var e=1;var a={cssclass:"red",TO:5000,CLOSE:false,TEXT:"Ошибка",TITLE:"Внимание"};var k={cssclass:"red",TO:5000,CLOSE:false,TEXT:"Ошибка",TITLE:"Внимание"};var d={info:"icon-info","!":"icon-exclamation"};var f={"!round":"image-exclamation-round",stop:"image-stop",info:"image-info",dead:"image-dead","!":"image-exclamation",bubble:"image-bubble",ok:"image-ok"};function i(){return ++e}var j={B:null,W:null,D:null,stack:null,init:function(){this.B=$("body");this.W=$(window);this.D=$(document);this.stack=[]},push:function(o){if((o instanceof c)){this.stack.push(o);o.handle.css({top:-100000+l,left:0+l}).appendTo(this.B).show();o.handle.addClass("EveFlash");o.measure();var n=this;n.updatePositions();o.handle.hide().css({left:this.calcLeft(o),top:this.calcTop(o)}).slideDown(400,function(){o.handle.addClass("EveFlashTrans")})}},flush:function(){for(var n=0;n<this.stack.length;n++){this.stack[n].destroy()}this.stack=[]},pop:function(p){var o=[];for(var n=0;n<this.stack.length;n++){if(p.id!==this.stack[n].id){o.push(this.stack[n])}}this.stack=o;p.destroy();this.updatePositions()},nowHeight:function(){var o=0;for(var n=0;n<this.stack.length;n++){o+=this.stack[n]._height}return o},updatePositions:function(){var o=this.nowHeight();var p=(this.WH()-o)/2;p=p<10?10:p;for(var n=0;n<this.stack.length;n++){this.stack[n].handle.css({top:p+l});p+=this.stack[n]._height}},calcLeft:function(n){return(this.WW()-n._width)/2},calcTop:function(p){var o=this.nowHeight();var q=(this.WH()-o)/2;q=q<10?10:q;for(var n=0;n<this.stack.length-1;n++){q+=this.stack[n]._height}return q},WH:function(){return parseFloat(this.W.innerHeight())},WW:function(){return parseFloat(this.W.innerWidth())}};function b(){if(h){return h}else{h=this}this.init()}b.prototype=j;var m={skeleton:'<div class="EveFlash"><span class="EveFlashClose" data-role="close" title="Закрыть"></span><span class="EveFlashImageSmall"></span><div class="EveFlashTitle" data-role="title"></div><div class="EveFlashContainer"><i class="EveFlashImage" data-role="image"></i><div class="EveFlashBody" data-role="body"></div><div class="EveFlashClearfix"></div></div></div>',TO:5000,cssclass:null,TIMER:null,TEXT:null,TITLE:null,CLOSE:false,ICON:false,IMAGE:false,handle:null,id:null,MIM:false,stack:null,applyParams:function(p){p=p||{};var o=jQuery.extend({},a,p);for(var n in o){if(n in this){this[n]=o[n]}}if(typeof(this.CLOSE)!="boolean"){this.CLOSE=a.CLOSE}if(this.TO!=parseInt(this.TO)){this.TO=0}else{this.TO=parseInt(this.TO)}},create:function(n){this.applyParams(n);this.id=i();this.handle=jQuery(this.skeleton);this.ScanRoles();this.setup()},ScanRoles:function(){this.R={};var n=this.R;this.handle.find("[data-role]").each(function(){var p=jQuery(this);var o=p.data("role");o?(n[o]=((o in n)?n[o].add(p):p)):false})},setup:function(){this.handle.addClass("EveFlash-status-"+this.cssclass);this.R.title.html(this.TITLE);this.R.body.html(this.GetText());if(this.CLOSE){this.handle.addClass("EveFlashClosable")}if(this.ICON){if(this.ICON in d){this.handle.addClass(d[this.ICON])}}if(this.IMAGE){if(this.IMAGE in f){this.handle.addClass(f[this.IMAGE])}}},append:function(){this.stack.push(this);this.launchTimer();this.attachHandlers()},close:function(){this.stack.pop(this)},destroy:function(){var n=this;this.detachHandlers();this.handle.removeClass("EveFlashTrans").slideUp(250,function(){n.handle.detach();n.handle.html("");n.handle=null})},measure:function(){this._width=parseFloat(this.handle.outerWidth(true));this._height=parseFloat(this.handle.outerHeight(true));var o=parseFloat(this.R.image.outerHeight(true));var n=parseFloat(this.R.body.outerHeight(true));var q=Math.max(o,n)-Math.min(o,n);if(q!=0){q=q/2;var p=o<n?this.R.image:this.R.body;p.css({"margin-top":q+l,"margin-bottom":q+l})}},lf2br:function(n){if(!(typeof(n)==="string")){try{n=n.toString()}catch(o){n="unstringable object"}}return n.replace(/\n/g,"<br>").replace(/\r/g,"")},GetText:function(){var q=this.TEXT;var p="";if(typeof(q)=="string"){return this.lf2br(q)}if(typeof(q)=="object"&&(q instanceof Array)){p="<ul>";for(var o=0;o<q.length;o++){p+="<li>"+this.lf2br(q[o])+"</li>"}p+="</ul>";return p}if(typeof(q)=="object"&&(q!==null)){p="<ul>";for(var n in q){if(q[n] instanceof (Array)){for(var o=0;o<q[n].length;o++){p+="<li><b>"+this.lf2br(n)+"<b>: "+this.lf2br(q[n])+"</li>"}}else{p+="<li><b>"+this.lf2br(n)+"<b>: "+this.lf2br(q[n])+"</li>"}}p+="</ul>";return p}return"Incorrect message"},launchTimer:function(){if(parseInt(this.TO)==this.TO){this.TO=parseInt(this.TO);if(this.TO>0){var n=this;this.TIMER=window.setTimeout(function(){if(n.MIM){n.hookMouseOut()}else{n.close()}},this.TO)}}},hookMouseOut:function(){var n=this;var o="EveFlash"+this.id;this.handle.on("mouseleave."+o,function(p){n.close()})},attachHandlers:function(){var n=this;var o="EveFlash"+this.id;if(this.CLOSE==false){this.handle.on("click."+o,function(p){n.close()})}this.R.close.on("click."+o,function(p){p.stopPropagation();n.close()});this.handle.on("mouseenter."+o,function(p){n.MIM=true}).on("mouseleave."+o,function(p){n.MIM=false})},detachHandlers:function(){var n="EveFlash"+this.id;this.handle.off("."+n);window.clearTimeout(this.TIMER)},init:function(n){this.stack=new b();this.create(n);this.append()}};function c(n){this.init(n)}c.prototype=m;c.setDefaults=function(p){if(typeof(p)!=="object"||p===null){a=k;return}for(var n in p){if(n in a){a[n]=p[n]}}return};c.setSkeleton=function(n){m.skeleton=n};c.setIcons=function(o){o=o||{};for(var n in o){d[n]=o[n]}};c.setImages=function(n){n=n||{};for(var o in n){f[o]=n[o]}};c.removeAll=function(){var n=new b();n.flush()};function g(p,u,w,r){var n=(!w||w==null)?r:w;var q="Ошибка!";var t="stop";var o="!";var v="red";if(n=="success"){q="Выполнено";t="ok";o="info";v="ntl"}var s={TEXT:p,TO:u,TITLE:q,cssclass:v,IMAGE:t,ICON:o};new c(s)}window.EveFlash=c;window.pi_flash=g;jQuery(function(){jQuery.pi_flash=g})})();